<?php
    if ($_SERVER['HTTP_REFERER'] == !'http://localhost/osc/borang_osc_2.php')
    { 
         header("location: /osc/index.html");
    }
    else
    {
        foreach($_GET as $loc=>$email)
        $_GET[$loc] = base64_decode(urldecode($email));
    
        if(isset($_GET[$loc]) && $_GET[$loc] !== '')
        {
            $email =  $_GET[$loc];

            $ = $_POST['11']; $ = $_POST['12']; $ = $_POST['13']; $ = $_POST['14']; $ = $_POST['15']; $ = $_POST['16']; $ = $_POST['17']; $ = $_POST['18']; $ = $_POST['19']; 
            $ = $_POST['21']; $ = $_POST['22']; $ = $_POST['23']; $ = $_POST['24']; $ = $_POST['25']; $ = $_POST['26']; $ = $_POST['27']; $ = $_POST['2']; $ = $_POST['']; 
            $ = $_POST['31']; $ = $_POST['32']; $ = $_POST['33']; $ = $_POST['34']; $ = $_POST['35']; $ = $_POST['36']; $ = $_POST['37']; $ = $_POST['3']; $ = $_POST[''];
            $ = $_POST['41']; $ = $_POST['42']; $ = $_POST['43']; $ = $_POST['44']; $ = $_POST['45']; $ = $_POST['46']; $ = $_POST['47']; $ = $_POST['4']; $ = $_POST['']; 
            $ = $_POST['51']; $ = $_POST['52']; $ = $_POST['53']; $ = $_POST['54']; $ = $_POST['55']; $ = $_POST['56']; $ = $_POST['57']; $ = $_POST['5']; $ = $_POST['']; 
            $ = $_POST['61']; $ = $_POST['62']; $ = $_POST['63']; $ = $_POST['64']; $ = $_POST['65']; $ = $_POST['66']; $ = $_POST['67']; $ = $_POST['6']; $ = $_POST['']; 
            $ = $_POST['71']; $ = $_POST['72']; $ = $_POST['73']; $ = $_POST['74']; $ = $_POST['75']; $ = $_POST['76']; $ = $_POST['77']; $ = $_POST['7']; $ = $_POST['']; 
            $ = $_POST['81']; $ = $_POST['82']; $ = $_POST['83']; $ = $_POST['84']; $ = $_POST['85']; $ = $_POST['86']; $ = $_POST['87']; $ = $_POST['8']; $ = $_POST['']; 
            $ = $_POST['91']; $ = $_POST['92']; $ = $_POST['93']; $ = $_POST['94']; $ = $_POST['95']; $ = $_POST['96']; $ = $_POST['97']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['101']; $ = $_POST['102']; $ = $_POST['103']; $ = $_POST['104']; $ = $_POST['105']; $ = $_POST['106']; $ = $_POST['107']; $ = $_POST['']; $ = $_POST[''];
            $ = $_POST['111']; $ = $_POST['112']; $ = $_POST['113']; $ = $_POST['114']; $ = $_POST['115']; $ = $_POST['116']; $ = $_POST['117']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['121']; $ = $_POST['122']; $ = $_POST['123']; $ = $_POST['124']; $ = $_POST['125']; $ = $_POST['126']; $ = $_POST['127']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['131']; $ = $_POST['132']; $ = $_POST['133']; $ = $_POST['134']; $ = $_POST['135']; $ = $_POST['136']; $ = $_POST['137']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['141']; $ = $_POST['142']; $ = $_POST['143']; $ = $_POST['144']; $ = $_POST['145']; $ = $_POST['146']; $ = $_POST['147']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['151']; $ = $_POST['152']; $ = $_POST['153']; $ = $_POST['154']; $ = $_POST['155']; $ = $_POST['156']; $ = $_POST['157']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['161']; $ = $_POST['162']; $ = $_POST['163']; $ = $_POST['164']; $ = $_POST['165']; $ = $_POST['166']; $ = $_POST['167']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['171']; $ = $_POST['172']; $ = $_POST['173']; $ = $_POST['174']; $ = $_POST['175']; $ = $_POST['176']; $ = $_POST['177']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['181']; $ = $_POST['182']; $ = $_POST['183']; $ = $_POST['184']; $ = $_POST['185']; $ = $_POST['186']; $ = $_POST['187']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['191']; $ = $_POST['192']; $ = $_POST['193']; $ = $_POST['194']; $ = $_POST['195']; $ = $_POST['196']; $ = $_POST['197']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['201']; $ = $_POST['202']; $ = $_POST['203']; $ = $_POST['204']; $ = $_POST['205']; $ = $_POST['206']; $ = $_POST['207']; $ = $_POST['']; $ = $_POST[''];
            $ = $_POST['211']; $ = $_POST['212']; $ = $_POST['213']; $ = $_POST['214']; $ = $_POST['215']; $ = $_POST['216']; $ = $_POST['217']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['221']; $ = $_POST['222']; $ = $_POST['223']; $ = $_POST['224']; $ = $_POST['225']; $ = $_POST['226']; $ = $_POST['227']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['231']; $ = $_POST['232']; $ = $_POST['233']; $ = $_POST['234']; $ = $_POST['235']; $ = $_POST['236']; $ = $_POST['237']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['241']; $ = $_POST['242']; $ = $_POST['243']; $ = $_POST['244']; $ = $_POST['245']; $ = $_POST['246']; $ = $_POST['247']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['251']; $ = $_POST['252']; $ = $_POST['253']; $ = $_POST['254']; $ = $_POST['255']; $ = $_POST['256']; $ = $_POST['257']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['261']; $ = $_POST['262']; $ = $_POST['263']; $ = $_POST['264']; $ = $_POST['265']; $ = $_POST['266']; $ = $_POST['267']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['271']; $ = $_POST['272']; $ = $_POST['273']; $ = $_POST['274']; $ = $_POST['275']; $ = $_POST['276']; $ = $_POST['277']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['281']; $ = $_POST['282']; $ = $_POST['283']; $ = $_POST['284']; $ = $_POST['285']; $ = $_POST['286']; $ = $_POST['287']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['291']; $ = $_POST['292']; $ = $_POST['293']; $ = $_POST['294']; $ = $_POST['295']; $ = $_POST['296']; $ = $_POST['297']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['301']; $ = $_POST['302']; $ = $_POST['303']; $ = $_POST['304']; $ = $_POST['305']; $ = $_POST['306']; $ = $_POST['307']; $ = $_POST['']; $ = $_POST[''];
            $ = $_POST['311']; $ = $_POST['312']; $ = $_POST['313']; $ = $_POST['314']; $ = $_POST['315']; $ = $_POST['316']; $ = $_POST['317']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['321']; $ = $_POST['322']; $ = $_POST['323']; $ = $_POST['324']; $ = $_POST['325']; $ = $_POST['326']; $ = $_POST['327']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['331']; $ = $_POST['332']; $ = $_POST['333']; $ = $_POST['334']; $ = $_POST['335']; $ = $_POST['336']; $ = $_POST['337']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['341']; $ = $_POST['342']; $ = $_POST['343']; $ = $_POST['344']; $ = $_POST['345']; $ = $_POST['346']; $ = $_POST['347']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['351']; $ = $_POST['352']; $ = $_POST['353']; $ = $_POST['354']; $ = $_POST['355']; $ = $_POST['356']; $ = $_POST['357']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['361']; $ = $_POST['362']; $ = $_POST['363']; $ = $_POST['364']; $ = $_POST['365']; $ = $_POST['366']; $ = $_POST['367']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['371']; $ = $_POST['372']; $ = $_POST['373']; $ = $_POST['374']; $ = $_POST['375']; $ = $_POST['376']; $ = $_POST['377']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['381']; $ = $_POST['382']; $ = $_POST['383']; $ = $_POST['384']; $ = $_POST['385']; $ = $_POST['386']; $ = $_POST['387']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['391']; $ = $_POST['392']; $ = $_POST['393']; $ = $_POST['394']; $ = $_POST['395']; $ = $_POST['396']; $ = $_POST['397']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['401']; $ = $_POST['402']; $ = $_POST['403']; $ = $_POST['404']; $ = $_POST['405']; $ = $_POST['406']; $ = $_POST['407']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['411']; $ = $_POST['412']; $ = $_POST['413']; $ = $_POST['414']; $ = $_POST['415']; $ = $_POST['416']; $ = $_POST['417']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['421']; $ = $_POST['422']; $ = $_POST['423']; $ = $_POST['424']; $ = $_POST['425']; $ = $_POST['426']; $ = $_POST['427']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['431']; $ = $_POST['432']; $ = $_POST['433']; $ = $_POST['434']; $ = $_POST['435']; $ = $_POST['436']; $ = $_POST['437']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['441']; $ = $_POST['442']; $ = $_POST['443']; $ = $_POST['444']; $ = $_POST['445']; $ = $_POST['446']; $ = $_POST['447']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['451']; $ = $_POST['452']; $ = $_POST['453']; $ = $_POST['454']; $ = $_POST['455']; $ = $_POST['456']; $ = $_POST['457']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['461']; $ = $_POST['462']; $ = $_POST['463']; $ = $_POST['464']; $ = $_POST['465']; $ = $_POST['466']; $ = $_POST['467']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['471']; $ = $_POST['472']; $ = $_POST['473']; $ = $_POST['474']; $ = $_POST['475']; $ = $_POST['476']; $ = $_POST['477']; $ = $_POST['']; $ = $_POST['']; 
            $ = $_POST['481']; $ = $_POST['482']; $ = $_POST['483']; $ = $_POST['484']; $ = $_POST['485']; $ = $_POST['486']; $ = $_POST['487']; $ = $_POST['']; $ = $_POST['']; 
                    
            if (empty($nama_ketua_projek) || empty($jawatan) || empty($staffid) || empty($pusat) || empty($email_1) || empty($warga) || empty($tel) || empty($klien) || empty($alamat_klien) || empty($tel_klien) || empty($faks_klien) || empty($email_klien) || empty($tajuk) || empty($bidang) || empty($dari_date) || empty($hingga_date) || empty($lokasi) || empty($kos) || empty($now_date_confirm)) 
            {
                ?>   
                    <script type="text/javascript">
                        alert("Kesemua maklumat diperlukan!"); 
                        history.go(-1);  
                        window.location.href="borang_osc_2.php?email=<?php echo urlencode(base64_encode($_GET[$loc])) ?>"; 
                    </script>
                <?php  
                die();
            }
            else
            { 
                $servername = "localhost";
                $dbusername = "root";
                $dbpassword = "";
                $db = "osc";   

                $con = mysqli_connect($servername, $dbusername, $dbpassword,$db);

                if (!$con) 
                {
                    die("Sambungan gagal! : " . mysqli_connect_error());
                }
                else
                {
                    $staf = mysqli_query($con,"SELECT email, fullname FROM staf_register WHERE email = '".$_GET[$loc]."'") or die ("Failed to query database" .mysql_error());
                    $row = mysqli_fetch_array($staf);

                    if($row['email'] == $_GET[$loc])
                    {
                        $INSERT = "INSERT INTO borang_osc_1(emailUser, nama_ketua_projek, jawatan, ic_num, staffid, pusat, email_1, warga, tel, klien, alamat_klien, tel_klien, faks_klien, email_klien, tajuk, bidang, dari_date, hingga_date, lokasi, kos, now_date_confirm) values('".$row['email']."', '$nama_ketua_projek', '$jawatan', '$ic_num', '$staffid', '$pusat', '$email_1', '$warga', '$tel', '$klien', '$alamat_klien', '$tel_klien', '$faks_klien', '$email_klien', '$tajuk', '$bidang', '$dari_date', '$hingga_date', '$lokasi', '$kos', '$now_date_confirm')";
                        
                        if(mysqli_query($con, $INSERT))
                        {
                            ?>
                                <script type="text/javascript">
                                    alert("Anda berjaya untuk masukkan data borang OSC 2!"); 
                                    location.replace("/osc/borang_osc_2.php?email=<?php echo urlencode(base64_encode($row['email'])) ?>");  
                                </script>
                            <?php
                            die();
                        }
                        else
                        {
                            ?>   
                                <script type="text/javascript">
                                    alert("Anda tidak berjaya untuk masukkan data borang OSC 2!"); 
                                    location.replace("/osc/borang_osc_2.php?email=<?php echo urlencode(base64_encode($row['email'])) ?>");  
                                </script>
                            <?php
                            //echo "ERROR: Could not able to execute $INSERT. " . mysqli_error($con);
                            die();
                        }
                    }
                }
            }
        } 
        else
        {
            header("location: /osc/index.html");
        }
    }
?>